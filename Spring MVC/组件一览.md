# ç»„ä»¶ä¸€è§ˆ

## 1. æ¦‚è¿°

åœ¨ [ã€Šç²¾å°½ Spring MVC æºç åˆ†æ â€”â€” å®¹å™¨çš„åˆå§‹åŒ–ï¼ˆäºŒï¼‰ä¹‹ Servlet WebApplicationContext å®¹å™¨ã€‹](http://svip.iocoder.cn/Spring-MVC/context-init-Servlet-WebApplicationContext) ä¸€æ–‡ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼Œä¼šè°ƒç”¨ DispatcherServlet çš„ `#initStrategies(ApplicationContext context)` æ–¹æ³•ï¼Œåˆå§‹åŒ– Spring MVC çš„å„ç§ç»„ä»¶ã€‚ä»£ç å¦‚ä¸‹ï¼š

```java
// DispatcherServlet.java

/** MultipartResolver used by this servlet. */
@Nullable
private MultipartResolver multipartResolver;

/** LocaleResolver used by this servlet. */
@Nullable
private LocaleResolver localeResolver;

/** ThemeResolver used by this servlet. */
@Nullable
private ThemeResolver themeResolver;

/** List of HandlerMappings used by this servlet. */
@Nullable
private List<HandlerMapping> handlerMappings;

/** List of HandlerAdapters used by this servlet. */
@Nullable
private List<HandlerAdapter> handlerAdapters;

/** List of HandlerExceptionResolvers used by this servlet. */
@Nullable
private List<HandlerExceptionResolver> handlerExceptionResolvers;

/** RequestToViewNameTranslator used by this servlet. */
@Nullable
private RequestToViewNameTranslator viewNameTranslator;

/** FlashMapManager used by this servlet. */
@Nullable
private FlashMapManager flashMapManager;

/** List of ViewResolvers used by this servlet. */
@Nullable
private List<ViewResolver> viewResolvers;
    
/**
 * This implementation calls {@link #initStrategies}.
 */
@Override
protected void onRefresh(ApplicationContext context) {
	initStrategies(context);
}
    
/**
 * Initialize the strategy objects that this servlet uses.
 * <p>May be overridden in subclasses in order to initialize further strategy objects.
 */
protected void initStrategies(ApplicationContext context) {
    // åˆå§‹åŒ– MultipartResolver
	initMultipartResolver(context);
	// åˆå§‹åŒ– LocaleResolver
	initLocaleResolver(context);
	// åˆå§‹åŒ– ThemeResolver
	initThemeResolver(context);
	// åˆå§‹åŒ– HandlerMappings
	initHandlerMappings(context);
	// åˆå§‹åŒ– HandlerAdapters
	initHandlerAdapters(context);
	// åˆå§‹åŒ– HandlerExceptionResolvers 
	initHandlerExceptionResolvers(context);
	// åˆå§‹åŒ– RequestToViewNameTranslator
	initRequestToViewNameTranslator(context);
	// åˆå§‹åŒ– ViewResolvers
	initViewResolvers(context);
	// åˆå§‹åŒ– FlashMapManager
	initFlashMapManager(context);
}
```

- ææŒ‡ä¸€ç®—ï¼Œä¸€å…±æœ‰ 9 ä¸ªç»„ä»¶ã€‚æœ¬æ–‡ï¼Œæˆ‘ä»¬å¯¹è¿™ 9 ä¸ªç»„ä»¶ï¼Œåšä¸€ä¸ªç®€å•çš„ä»‹ç»ã€‚

å½“ç„¶ï¼Œåœ¨å…·ä½“ä»‹ç»ç»„ä»¶ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜æ˜¯é€šè¿‡ä¸€å¼ å›¾ï¼Œæ¥çœ‹çœ‹è¿™äº›ç»„ä»¶ï¼Œåœ¨ä¸€æ¬¡ç”¨æˆ·çš„è¯·æ±‚ä¸­ï¼Œæ‰®æ¼”äº†ä»€ä¹ˆæ ·çš„è§’è‰²ã€‚

FROM [ã€ŠSpring MVC åŸç†æ¢ç§˜ â€”â€” ä¸€ä¸ªè¯·æ±‚çš„æ—…è¡Œè¿‡ç¨‹ã€‹](https://www.tianxiaobo.com/2018/06/29/Spring-MVC-åŸç†æ¢ç§˜-ä¸€ä¸ªè¯·æ±‚çš„æ—…è¡Œè¿‡ç¨‹/)

![img](ç»„ä»¶ä¸€è§ˆ.assets/15300766829012.jpg)

- å½“ç„¶ï¼Œè¿™ä¸ªå›¾å¹¶æ²¡æœ‰åŒ…æ‹¬æ‰€æœ‰çš„ç»„ä»¶ï¼Œä¸»è¦æ¶‰åŠæœ€æ ¸å¿ƒçš„ç»„ä»¶ã€‚ğŸ˜ˆ

## 2. MultipartResolver

`org.springframework.web.multipart.MultipartResolver` ï¼Œå†…å®¹ç±»å‹( `Content-Type` )ä¸º `multipart/*` çš„è¯·æ±‚çš„è§£æå™¨æ¥å£ã€‚

ä¾‹å¦‚ï¼Œæ–‡ä»¶ä¸Šä¼ è¯·æ±‚ï¼ŒMultipartResolver ä¼šå°† HttpServletRequest å°è£…æˆ MultipartHttpServletRequest ï¼Œè¿™æ ·ä» MultipartHttpServletRequest ä¸­è·å¾—ä¸Šä¼ çš„æ–‡ä»¶ã€‚å…·ä½“çš„ä½¿ç”¨ç¤ºä¾‹ï¼Œå‚è§ [ã€Šspring-boot ä¸Šä¼ æ–‡ä»¶ MultiPartFile è·å–ä¸åˆ°æ–‡ä»¶é—®é¢˜è§£å†³ã€‹](https://blog.csdn.net/happy_cheng/article/details/54178392)

å…³äºå†…å®¹ç±»å‹( `Content-Type` )ä¸º `multipart/*` ï¼Œèƒ–å‹å¯ä»¥çœ‹çœ‹ [ã€ŠHTTP åè®®ä¹‹ multipart/form-data è¯·æ±‚åˆ†æã€‹](https://blog.csdn.net/five3/article/details/7181521) æ–‡ç« ã€‚

MultipartResolver æ¥å£ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
/ MultipartResolver.java

public interface MultipartResolver {

	/**
     * æ˜¯å¦ä¸º multipart è¯·æ±‚
	 */
	boolean isMultipart(HttpServletRequest request);

	/**
     * å°† HttpServletRequest è¯·æ±‚å°è£…æˆ MultipartHttpServletRequest å¯¹è±¡
	 */
	MultipartHttpServletRequest resolveMultipart(HttpServletRequest request) throws MultipartException;

	/**
     * æ¸…ç†å¤„ç† multipart äº§ç”Ÿçš„èµ„æºï¼Œä¾‹å¦‚ä¸´æ—¶æ–‡ä»¶
     *
	 */
	void cleanupMultipart(MultipartHttpServletRequest request);

}
```



## 3. LocaleResolver

`org.springframework.web.servlet.LocaleResolver` ï¼Œæœ¬åœ°åŒ–( å›½é™…åŒ– )è§£æå™¨æ¥å£ã€‚ä»£ç å¦‚ä¸‹ï¼š

```java
// LocaleResolver.java

public interface LocaleResolver {

	/**
     * ä»è¯·æ±‚ä¸­ï¼Œè§£æå‡ºè¦ä½¿ç”¨çš„è¯­è¨€ã€‚ä¾‹å¦‚ï¼Œè¯·æ±‚å¤´çš„ "Accept-Language"
	 */
	Locale resolveLocale(HttpServletRequest request);

	/**
     * è®¾ç½®è¯·æ±‚æ‰€ä½¿ç”¨çš„è¯­è¨€
	 */
	void setLocale(HttpServletRequest request, @Nullable HttpServletResponse response, @Nullable Locale locale);

}
```

å…·ä½“çš„ä½¿ç”¨ç¤ºä¾‹ï¼Œå‚è§ [ã€ŠSpringMVCå­¦ä¹ ç³»åˆ—ï¼ˆ8ï¼‰ ä¹‹ å›½é™…åŒ–ã€‹](https://www.cnblogs.com/liukemng/p/3750117.html) ã€‚



## 4. ThemeResolver

`org.springframework.web.servlet.ThemeResolver` ï¼Œä¸»é¢˜è§£æå™¨æ¥å£ã€‚ä»£ç å¦‚ä¸‹ï¼š

```java
// ThemeResolver.java

public interface ThemeResolver {

	/**
     * ä»è¯·æ±‚ä¸­ï¼Œè§£æå‡ºä½¿ç”¨çš„ä¸»é¢˜ã€‚ä¾‹å¦‚ï¼Œä»è¯·æ±‚å¤´ User-Agent ï¼Œåˆ¤æ–­ä½¿ç”¨ PC ç«¯ï¼Œè¿˜æ˜¯ç§»åŠ¨ç«¯çš„ä¸»é¢˜
	 */
	String resolveThemeName(HttpServletRequest request);

	/**
     * è®¾ç½®è¯·æ±‚ï¼Œæ‰€ä½¿ç”¨çš„ä¸»é¢˜ã€‚
	 */
	void setThemeName(HttpServletRequest request, @Nullable HttpServletResponse response, @Nullable String themeName);

}
```

å…·ä½“çš„ä½¿ç”¨ç¤ºä¾‹ï¼Œå‚è§ [ã€Šå¦‚ä½•ä½¿ç”¨ Spring MVC ä¸»é¢˜ã€‹](https://blog.csdn.net/neweastsun/article/details/79213867) ã€‚

å½“ç„¶ï¼Œå› ä¸ºç°åœ¨çš„å‰ç«¯ï¼ŒåŸºæœ¬å’Œåç«¯åšäº†åˆ†ç¦»ï¼Œæ‰€ä»¥è¿™ä¸ªåŠŸèƒ½å·²ç»è¶Šæ¥è¶Šå°‘ç”¨äº†ã€‚



## 5. HandlerMapping

`org.springframework.web.servlet.HandlerMapping` ï¼Œå¤„ç†å™¨åŒ¹é…æ¥å£ï¼Œæ ¹æ®è¯·æ±‚( `handler` )è·å¾—å…¶çš„å¤„ç†å™¨( `handler` )å’Œæ‹¦æˆªå™¨ä»¬( HandlerInterceptor æ•°ç»„ )ã€‚ä»£ç å¦‚ä¸‹ï¼š

```java
// HandlerMapping.java

public interface HandlerMapping {

	String PATH_WITHIN_HANDLER_MAPPING_ATTRIBUTE = HandlerMapping.class.getName() + ".pathWithinHandlerMapping";
	String BEST_MATCHING_PATTERN_ATTRIBUTE = HandlerMapping.class.getName() + ".bestMatchingPattern";
	String INTROSPECT_TYPE_LEVEL_MAPPING = HandlerMapping.class.getName() + ".introspectTypeLevelMapping";
	String URI_TEMPLATE_VARIABLES_ATTRIBUTE = HandlerMapping.class.getName() + ".uriTemplateVariables";
	String MATRIX_VARIABLES_ATTRIBUTE = HandlerMapping.class.getName() + ".matrixVariables";
	String PRODUCIBLE_MEDIA_TYPES_ATTRIBUTE = HandlerMapping.class.getName() + ".producibleMediaTypes";

	/**
     * è·å¾—è¯·æ±‚å¯¹åº”çš„å¤„ç†å™¨å’Œæ‹¦æˆªå™¨ä»¬
	 */
	@Nullable
	HandlerExecutionChain getHandler(HttpServletRequest request) throws Exception;

}
```

- è¿”å›çš„å¯¹è±¡ç±»å‹æ˜¯ HandlerExecutionChain ï¼Œå®ƒåŒ…å«å¤„ç†å™¨( `handler` )å’Œæ‹¦æˆªå™¨ä»¬( HandlerInterceptor æ•°ç»„ )ã€‚ç®€å•ä»£ç å¦‚ä¸‹ï¼š

```java
// HandlerExecutionChain.java

/**
 * å¤„ç†å™¨
 */
private final Object handler;
/**
 * æ‹¦æˆªå™¨æ•°ç»„
 */
@Nullable
private HandlerInterceptor[] interceptors;

```

- æ³¨æ„ï¼Œå¤„ç†å™¨çš„ç±»å‹å¯èƒ½å’Œæˆ‘ä»¬æƒ³çš„ä¸å¤ªä¸€æ ·ï¼Œæ˜¯ä¸ª **Object** ç±»å‹ã€‚





## 6. HandlerAdapter

`org.springframework.web.servlet.HandlerAdapter` ï¼Œå¤„ç†å™¨é€‚é…å™¨æ¥å£ã€‚ä»£ç å¦‚ä¸‹ï¼š

```java
// HandlerAdapter.java

public interface HandlerAdapter {

	/**
     * æ˜¯å¦æ”¯æŒè¯¥å¤„ç†å™¨
	 */
	boolean supports(Object handler);

	/**
     * æ‰§è¡Œå¤„ç†å™¨ï¼Œè¿”å› ModelAndView ç»“æœ
	 */
	@Nullable
	ModelAndView handle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception;

	/**
     * è¿”å›è¯·æ±‚çš„æœ€æ–°æ›´æ–°æ—¶é—´ã€‚
     *
     * å¦‚æœä¸æ”¯æŒè¯¥æ“ä½œï¼Œåˆ™è¿”å› -1 å³å¯
	 */
	long getLastModified(HttpServletRequest request, Object handler);

}
```

- å› ä¸ºï¼Œå¤„ç†å™¨ `handler` çš„ç±»å‹æ˜¯ Object ç±»å‹ï¼Œéœ€è¦æœ‰ä¸€ä¸ªè°ƒç”¨è€…æ¥å®ç° `handler` æ˜¯æ€ä¹ˆè¢«ä½¿ç”¨ï¼Œæ€ä¹ˆè¢«æ‰§è¡Œã€‚è€Œ HandlerAdapter çš„ç”¨é€”å°±åœ¨äºæ­¤ã€‚å¯èƒ½å¦‚æœæ¥å£åæ”¹æˆ HandlerInvoker ï¼Œç¬”è€…è§‰å¾—ä¼šæ›´å¥½ç†è§£ã€‚
- ä¸‰ä¸ªæ¥å£ï¼Œä»£ç æ¯”è¾ƒå¥½ç†è§£ï¼Œèƒ–å‹ç…ä¸€çœ¼ï¼Œå°±ä¸ç»†è®²äº†ã€‚



## 7. HandlerExceptionResolver

`org.springframework.web.servlet.HandlerExceptionResolver` ï¼Œå¤„ç†å™¨å¼‚å¸¸è§£æå™¨æ¥å£ï¼Œå°†å¤„ç†å™¨( `handler` )æ‰§è¡Œæ—¶å‘ç”Ÿçš„å¼‚å¸¸ï¼Œè§£æ( è½¬æ¢ )æˆå¯¹åº”çš„ ModelAndView ç»“æœã€‚ä»£ç å¦‚ä¸‹ï¼š

```java
// HandlerExceptionResolver.java

public interface HandlerExceptionResolver {

	/**
     * è§£æå¼‚å¸¸ï¼Œè½¬æ¢æˆå¯¹åº”çš„ ModelAndView ç»“æœ
	 */
	@Nullable
	ModelAndView resolveException(
			HttpServletRequest request, HttpServletResponse response, @Nullable Object handler, Exception ex);

}
```



## 8. RequestToViewNameTranslator

`org.springframework.web.servlet.RequestToViewNameTranslator` ï¼Œè¯·æ±‚åˆ°è§†å›¾åçš„è½¬æ¢å™¨æ¥å£ã€‚ä»£ç å¦‚ä¸‹ï¼š

```java
// RequestToViewNameTranslator.java

public interface RequestToViewNameTranslator {

	/**
     * æ ¹æ®è¯·æ±‚ï¼Œè·å¾—å…¶è§†å›¾å
	 */
	@Nullable
	String getViewName(HttpServletRequest request) throws Exception;

}
```



## 9. ViewResolver

`org.springframework.web.servlet.ViewResolver` ï¼Œå®ä½“è§£æå™¨æ¥å£ï¼Œæ ¹æ®è§†å›¾åå’Œå›½é™…åŒ–ï¼Œè·å¾—æœ€ç»ˆçš„è§†å›¾ View å¯¹è±¡ã€‚ä»£ç å¦‚ä¸‹ï¼š

```java
// ViewResolver.java

public interface ViewResolver {

	/**
     * æ ¹æ®è§†å›¾åå’Œå›½é™…åŒ–ï¼Œè·å¾—æœ€ç»ˆçš„ View å¯¹è±¡
	 */
	@Nullable
	View resolveViewName(String viewName, Locale locale) throws Exception;

}
```

ViewResolver çš„å®ç°ç±»æ¯”è¾ƒå¤šï¼Œä¾‹å¦‚è¯´ï¼ŒInternalResourceViewResolver è´Ÿè´£è§£æ JSP è§†å›¾ï¼ŒFreeMarkerViewResolver è´Ÿè´£è§£æ Freemarker è§†å›¾ã€‚å½“ç„¶ï¼Œè¯¦ç»†çš„ï¼Œæˆ‘ä»¬åç»­æ–‡ç« è§£æã€‚



## 10. FlashMapManager

`org.springframework.web.servlet.FlashMapManager` ï¼ŒFlashMap ç®¡ç†å™¨æ¥å£ï¼Œè´Ÿè´£é‡å®šå‘æ—¶ï¼Œä¿å­˜å‚æ•°åˆ°ä¸´æ—¶å­˜å‚¨ä¸­ã€‚ä»£ç å¦‚ä¸‹ï¼š

```java
// FlashMapManager.java

public interface FlashMapManager {

	/**
     * æ¢å¤å‚æ•°ï¼Œå¹¶å°†æ¢å¤è¿‡çš„å’Œè¶…æ—¶çš„å‚æ•°ä»ä¿å­˜ä»‹è´¨ä¸­åˆ é™¤
	 */
	@Nullable
	FlashMap retrieveAndUpdate(HttpServletRequest request, HttpServletResponse response);

	/**
     * å°†å‚æ•°ä¿å­˜èµ·æ¥
	 */
	void saveOutputFlashMap(FlashMap flashMap, HttpServletRequest request, HttpServletResponse response);

}
```

é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªä¸´æ—¶å­˜å‚¨ä¼šæ˜¯ Session ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼š

- é‡å®šå‘å‰ï¼Œä¿å­˜å‚æ•°åˆ° Seesion ä¸­ã€‚
- é‡å®šå‘åï¼Œä» Session ä¸­è·å¾—å‚æ•°ï¼Œå¹¶ç§»é™¤ã€‚

å…·ä½“ä½¿ç”¨ç¤ºä¾‹ï¼Œå‚è§ [ã€ŠSpring MVC Flash Attribute çš„è®²è§£ä¸ä½¿ç”¨ç¤ºä¾‹ã€‹](https://www.oschina.net/translate/spring-mvc-flash-attribute-example) ä¸€æ–‡ã€‚

å½“ç„¶ï¼Œå®é™…åœºæ™¯ä¸‹ï¼Œä½¿ç”¨çš„éå¸¸å°‘ï¼Œç‰¹åˆ«æ˜¯å‰åç«¯åˆ†ç¦»ä¹‹åã€‚



## 666. å½©è›‹

å°å°æ°´æ–‡ä¸€ç¯‡ï¼Œå…ˆä¸€èµ·äº†è§£ä¸‹ Spring MVC çš„ç»„ä»¶ã€‚é…±ç´«ï¼Œæˆ‘ä»¬ä¸‹ä¸€ç¯‡å¥½æ•´ä½“çš„äº†è§£ä¸€ä¸ªç”¨æˆ·çš„è¯·æ±‚ï¼ŒDispatcherServlet æ˜¯å¦‚ä½•ä½¿ç”¨ä¸Šè¿°çš„ç»„ä»¶ï¼Œå¯¹å…¶è¿›è¡Œå¤„ç†çš„ã€‚

å‚è€ƒå’Œæ¨èå¦‚ä¸‹æ–‡ç« ï¼š

- ç”°å°æ³¢ [ã€ŠSpring MVC åŸç†æ¢ç§˜ - ä¸€ä¸ªè¯·æ±‚çš„æ—…è¡Œè¿‡ç¨‹ã€‹](https://www.tianxiaobo.com/2018/06/29/Spring-MVC-åŸç†æ¢ç§˜-ä¸€ä¸ªè¯·æ±‚çš„æ—…è¡Œè¿‡ç¨‹/)
- glmapper [ã€ŠSpringMVC æºç ç³»åˆ—ï¼šä¹å¤§ç»„ä»¶å°è®°ã€‹](http://www.glmapper.com/2018/11/10/spring-base-webmvc5/)
- éƒä½³ [ã€ŠSpring æºç æ·±åº¦è§£æã€‹](https://item.jd.com/11311737.html) çš„ [ã€Œ11.3 DispatcherServletã€](http://svip.iocoder.cn/Spring-MVC/Components-intro/#) å°èŠ‚
- éŸ©è·¯å½ª [ã€Šçœ‹é€ Spring MVCï¼šæºä»£ç åˆ†æä¸å®è·µã€‹](https://item.jd.com/11807414.html) çš„ [ã€Œç¬¬9ç«  åˆ›å»º Spring MVC ä¹‹å™¨ã€](http://svip.iocoder.cn/Spring-MVC/Components-intro/#) å°èŠ‚



